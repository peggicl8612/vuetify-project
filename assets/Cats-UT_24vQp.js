import{_ as ae,u as te,G as le,ay as re,K as V,c as T,aq as se,ar as B,az as ne,aA as oe,as as ie,at as v,r as de,o as k,h as M,d as r,w as s,V as ue,ai as pe,aj as P,E as p,t as d,z as me,aB as ge,$ as ce,e as x,p as D,f as m,g as ve,ak as R,x as be,b as j,B as fe,au as Ve,j as n,av as ke,an as xe,ao as ye,ax as we,aC as N,aD as Ae,ap as Ce,aE as $e,F as Be,C as O,I as De,aF as E,aG as Se}from"./index-BEtRR4YY.js";import{V as qe}from"./VTextarea-4VHmA_oE.js";const Fe={class:"text-center font-weight-bold",style:{color:"#a59aa3"}},Te={key:0,class:"text-brown"},Me={key:1,class:"text-grey--text"},Re={class:"text-primary"},K={__name:"Cats",setup(Ee){const{t}=te(),{apiAuth:S}=De(),b=le(),c=re([]),q=V(""),H=T(()=>[{title:"ID",key:"_id",sortable:!0},{title:t("cat.image"),key:"image",sortable:!1},{title:t("cat.name"),key:"name",sortable:!1},{title:t("cat.age"),key:"age",sortable:!0},{title:t("cats.gender"),key:"gender",sortable:!0},{title:t("cat.breed"),key:"breed",sortable:!0},{title:t("cat.isAdopting"),key:"isAdopting",sortable:!0},{title:t("cat.description"),key:"description",sortable:!1},{title:t("cat.createdAt"),key:"createdAt",sortable:!0},{title:t("cat.updatedAt"),key:"updatedAt",sortable:!0},{title:t("adminCat.edit"),key:"edit",sortable:!1}]),I=async()=>{var l,a;try{const{data:i}=await S.get("/cat/all");c.push(...i.result)}catch(i){b({text:t("api."+(((a=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:a.message)||"unknownError")),snackbarProps:{color:"rgb(212, 135, 141)"}})}};I();const u=V({open:!1,id:""}),U=l=>{l?(A.value.value=l.breed||"",u.value.id=l._id,y.value.value=l.name,w.value.value=l.age,C.value.value=l.description,f.value.value=!!l.isAdopting,$.value.value=l.gender):f.value.value=!1,u.value.open=!0},G=()=>{W(),u.value.id="",u.value.open=!1,L.value.deleteFileRecord()},J=se({name:B().required(t("api.catNameRequired")),breed:B().required(t("api.catBreedRequired")).oneOf(["black","orange","flower","tiger"],t("api.catBreedRequired")),age:ne().typeError(t("api.catAgeInvalid")).required(t("api.catAgeRequired")),description:B().required(t("api.catDescriptionRequired")),gender:B().required(t("api.catGenderRequired")).oneOf(["Male","Female"],t("api.catGenderRequired")),isAdopting:oe().required(t("api.catIsadoptingRequired"))}),{handleSubmit:Q,isSubmitting:h,resetForm:W}=ie({validationSchema:J,initialValues:{name:"",age:"",description:"",breed:"",gender:"",isAdopting:!1}}),y=v("name"),w=v("age"),A=v("breed"),C=v("description"),$=v("gender"),f=v("isAdopting",void 0,{initialValue:!1}),X=T(()=>[{text:t("cat.selectBreed"),value:""},{text:t("catBreed.black"),value:"black"},{text:t("catBreed.orange"),value:"orange"},{text:t("catBreed.flower"),value:"flower"},{text:t("catBreed.tiger"),value:"tiger"}]),Y=T(()=>[{text:t("cat.selectGender"),value:""},{text:t("catBreed.Male"),value:"Male"},{text:t("catBreed.Female"),value:"Female"}]),L=V(null),g=V([]),z=V([]),Z=Q(async l=>{var a,i,e,F;if(!((a=g.value[0])!=null&&a.error)){if(u.value.id.length===0&&g.value.length===0){b({text:t("api.CatImageRequired"),snackbarProps:{color:"red"}});return}try{const o=new FormData;if(o.append("name",l.name),o.append("age",l.age),o.append("description",l.description),o.append("breed",l.breed),o.append("gender",l.gender),o.append("isAdopting",l.isAdopting?"true":"false"),g.value.length>0&&!((i=g.value[0])!=null&&i.error)?o.append("image",g.value[0].file):o.append("image",u.value.image||null),u.value.id.length>0)await S.patch("/cat/"+u.value.id,o);else{const{data:ee}=await S.post("/cat",o);console.log(ee)}c.splice(0,c.length),I(),b({text:t(u.value.id.length>0?"adminCat.editSuccess":"adminCat.newSuccess"),snackbarProps:{color:"rgb(117, 117, 117)"}}),G()}catch(o){console.log(o),b({text:t("api."+(((F=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:F.message)||"unknownError")),snackbarProps:{color:"rgb(212, 135, 141)"}})}}}),_=()=>{if(!c.length){b({text:t("adminCat.noDataToExport"),snackbarProps:{color:"red"}});return}const l=c.map(e=>({ID:e._id,名字:e.name,年齡:e.age,性別:t(`catGender.${e.gender}`),品種:t(`catBreed.${e.breed}`),是否可領養:e.isAdopting?t("adminCat.yes"):t("adminCat.no"),描述:e.description,創建時間:new Date(e.createdAt).toLocaleString(),更新時間:new Date(e.updatedAt).toLocaleString()})),a=E.json_to_sheet(l),i=E.book_new();E.book_append_sheet(i,a,"貓咪資料"),Se(i,"貓咪資料.xlsx")};return(l,a)=>{const i=de("VueFileAgent");return k(),M(Be,null,[r(fe,{class:"container"},{default:s(()=>[r(ue,null,{default:s(()=>[r(pe,null,{default:s(()=>[r(P,{cols:"12"},{default:s(()=>[p("h1",Fe,d(l.$t("nav.adminCats")),1)]),_:1}),r(me),r(P,{cols:"12"},{default:s(()=>[r(ge,{items:c,headers:H.value,class:"table",search:q.value},{top:s(()=>[r(ce,{flat:""},{default:s(()=>[r(x,{color:"brown",rounded:"",onClick:a[0]||(a[0]=e=>U(null))},{default:s(()=>[r(D,null,{default:s(()=>a[11]||(a[11]=[m("mdi-plus")])),_:1}),m(" "+d(l.$t("adminCat.new")),1)]),_:1}),r(ve),r(R,{modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e),"prepend-inner-icon":"mdi-magnify",variant:"plain",class:"search-field",placeholder:"搜尋貓咪",style:{"background-color":"#e7e4e7","border-radius":"60px"},dense:""},null,8,["modelValue"])]),_:1})]),"item.image":s(({value:e})=>[r(be,{src:e,height:"100",width:"100"},null,8,["src"])]),"item.isAdopting":s(({value:e})=>[e?(k(),j(D,{key:0,color:"brown"},{default:s(()=>a[12]||(a[12]=[m("mdi-check-circle")])),_:1})):(k(),j(D,{key:1,color:"red"},{default:s(()=>a[13]||(a[13]=[m("mdi-close-circle")])),_:1}))]),"item.age":s(({value:e})=>[e?(k(),M("span",Te,d(e)+" 歲",1)):(k(),M("span",Me,"未知"))]),"item.createdAt":s(({value:e})=>[p("span",null,d(new Date(e).toLocaleDateString()),1),a[14]||(a[14]=p("br",null,null,-1)),p("span",null,d(new Date(e).toLocaleTimeString()),1),a[15]||(a[15]=p("br",null,null,-1))]),"item.updatedAt":s(({value:e})=>[p("span",null,d(new Date(e).toLocaleDateString()),1),a[16]||(a[16]=p("br",null,null,-1)),p("span",null,d(new Date(e).toLocaleTimeString()),1),a[17]||(a[17]=p("br",null,null,-1))]),"item.breed":s(({value:e})=>[p("span",Re,d(l.$t("catBreed."+e)),1)]),"item.gender":s(({value:e})=>[p("span",null,d(l.$t("catGender."+e)),1)]),"item.edit":s(({item:e})=>[r(x,{icon:"mdi-pencil",variant:"text",color:"brown",onClick:F=>U(e)},null,8,["onClick"])]),_:2},1032,["items","headers","search"])]),_:1})]),_:1})]),_:1})]),_:1}),r($e,{modelValue:u.value.open,"onUpdate:modelValue":a[10]||(a[10]=e=>u.value.open=e),persistent:""},{default:s(()=>[r(Ve,{disabled:n(h),onSubmit:ke(n(Z),["prevent"])},{default:s(()=>[r(xe,null,{default:s(()=>[r(ye,null,{default:s(()=>[m(d(l.$t(u.value.id?"adminCat.edit":"adminCat.new")),1)]),_:1}),r(we,null,{default:s(()=>[r(R,{modelValue:n(y).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>n(y).value.value=e),label:l.$t("cat.name"),"error-messages":n(y).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(R,{modelValue:n(w).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>n(w).value.value=e),label:l.$t("cat.age"),"error-messages":n(w).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","label","error-messages"]),r(N,{modelValue:n($).value.value,"onUpdate:modelValue":a[4]||(a[4]=e=>n($).value.value=e),"error-messages":n($).errorMessage.value,items:Y.value,"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),r(N,{modelValue:n(A).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>n(A).value.value=e),"error-messages":n(A).errorMessage.value,items:X.value,"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),r(Ae,{modelValue:n(f).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>n(f).value.value=e),label:l.$t("cat.isAdopting"),"error-messages":n(f).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(qe,{modelValue:n(C).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>n(C).value.value=e),label:l.$t("cat.description"),"error-messages":n(C).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(i,{ref_key:"fileAgent",ref:L,modelValue:g.value,"onUpdate:modelValue":a[8]||(a[8]=e=>g.value=e),"raw-model-value":z.value,"onUpdate:rawModelValue":a[9]||(a[9]=e=>z.value=e),accept:"image/jpeg,image/png","help-text":l.$t("fileAgent.helpText"),"error-text":{type:l.$t("fileAgent.errorType"),size:l.$t("fileAgent.errorSize")},deletable:"","max-size":"1MB",required:""},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),r(Ce,null,{default:s(()=>[r(x,{onClick:G},{default:s(()=>[m(d(l.$t("adminCat.cancel")),1)]),_:1}),r(x,{type:"submit",loading:n(h)},{default:s(()=>[m(d(l.$t("adminCat.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),r(x,{class:"excel text-grey bg-gray-darken-2 rounded-lg px-5 mt-4",onClick:_},{default:s(()=>[m(d(l.$t("adminCat.exportExcel"))+" ",1),r(D,{end:""},{default:s(()=>a[18]||(a[18]=[m("mdi-file-excel")])),_:1})]),_:1})],64)}}};typeof O=="function"&&O(K);const Ge=ae(K,[["__scopeId","data-v-f2849efd"]]);export{Ge as default};
