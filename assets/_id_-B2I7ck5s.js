import{aX as k,H as q,u as I,a as w,G as F,K as B,aq as $,az as x,as as E,at as N,o as P,h as Q,d as a,w as t,ai as j,aj as p,E as i,t as o,z as M,x as R,au as z,j as u,av as A,ak as D,e as O,f as T,V as U,aY as G,F as H,C as f,I as K}from"./index-mnwSAXNX.js";const L={class:"text-center"},X={class:"text-center"},Y={__name:"[id]",setup(J){const{api:b,apiAuth:V}=K(),h=k(),m=q(),{t:s}=I(),g=w(),v=F(),n=B({_id:"",name:"",price:0,description:"",image:"",sell:!0,breed:""});(async()=>{try{const{data:e}=await b.get("/product/"+h.params.id);n.value=e.result,document.title=n.value.name+" | 咪凹屋"}catch(e){console.log(e),m.push("/")}})();const _=$({quantity:x().typeError(s("product.addCartQuantityInvalid")).required(s("product.addCartQuantityInvalid")).positive(s("product.addCartQuantityInvalid")).integer(s("product.addCartQuantityInvalid"))}),{handleSubmit:C,isSubmitting:y}=E({validationSchema:_,initialValues:{quantity:1}}),c=N("quantity"),S=C(async e=>{var l,d;if(!g.isLoggedIn){m.push("/login");return}try{const{data:r}=await V.patch("/user/cart",{cat:n.value._id,quantity:e.quantity});g.cart=r.result,v({text:s("product.addCartSuccess"),snackbarProps:{color:"green"}})}catch(r){console.log(r),v({text:s("api."+(((d=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:d.message)||"unknownError")),snackbarProps:{color:"red"}})}});return(e,l)=>(P(),Q(H,null,[a(U,null,{default:t(()=>[a(j,null,{default:t(()=>[a(p,{cols:"12"},{default:t(()=>[i("h1",L,o(n.value.name),1)]),_:1}),a(M),a(p,{cols:"12",md:"6"},{default:t(()=>[a(R,{src:e.product.image},null,8,["src"])]),_:1}),a(p,{cols:"12",md:"6"},{default:t(()=>[i("p",null,o(e.$t("catBreed."+n.value.breed)),1),i("p",null,o(e.product.price),1),i("p",null,o(e.product.description),1),a(z,{disabled:u(y),onSubmit:A(u(S),["prevent"])},{default:t(()=>[a(D,{modelValue:u(c).value.value,"onUpdate:modelValue":l[0]||(l[0]=d=>u(c).value.value=d),modelModifiers:{number:!0},type:"number","error-messages":u(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(O,{type:"submit","prepend-icon":"mdi-cart",loading:u(y)},{default:t(()=>[T(o(e.$t("product.addCart")),1)]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(G,{"model-value":!e.product.sell,class:"align-center justify-center",scrim:"black",opacity:"0.8",persistent:""},{default:t(()=>[i("h1",X,o(e.$t("api.productNotOnSell")),1)]),_:1},8,["model-value"])],64))}};typeof f=="function"&&f(Y);export{Y as default};
