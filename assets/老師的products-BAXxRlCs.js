import{u as G,G as K,ay as H,K as g,c as R,aq as J,ar as S,az as Q,aA as W,as as X,at as v,r as Y,o as T,h as Z,d as r,w as o,ai as _,aj as U,E as ee,t as i,z as ae,aB as te,$ as le,e as A,f as c,g as re,ak as x,x as oe,b as se,p as ue,k as ne,V as de,au as ie,j as s,av as ce,an as pe,ao as me,ax as ge,aC as ve,aD as Ve,ap as fe,aE as be,F as ye,C as M,I as ke}from"./index-DfpASpyj.js";import{V as we}from"./VTextarea-Djzy5ENV.js";const Ae={class:"text-center"},$e={__name:"老師的products",setup(Ce){const{t}=G(),{apiAuth:$}=ke(),V=K(),f=H([]),C=g(""),E=R(()=>[{title:"ID",key:"_id",sortable:!0},{title:t("product.image"),key:"image",sortable:!1},{title:t("product.name"),key:"name",sortable:!0},{title:t("product.description"),key:"description",sortable:!0},{title:t("cat.age"),key:"age",sortable:!0},{title:t("cat.category"),key:"category",sortable:!0},{title:t("product.sell"),key:"sell",sortable:!0},{title:t("product.createdAt"),key:"createdAt",sortable:!0},{title:t("product.updatedAt"),key:"updatedAt",sortable:!0},{title:t("adminProduct.edit"),key:"edit",sortable:!1}]),q=async()=>{var e,l;try{const{data:d}=await $.get("/product/all");f.push(...d.result)}catch(d){console.log(d),V({text:t("api."+(((l=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:l.message)||"unknownError")),snackbarProps:{color:"red"}})}};q();const n=g({open:!1,id:""}),B=e=>{e&&(console.log("item.category:",e.category),m.value.value=["black","orange","flower","tiger"].includes(e.category)?e.category:"",console.log("category.value.value:",m.value.value),n.value.id=e._id,b.value.value=e.name,y.value.value=e.age,k.value.value=e.description,w.value.value=e.sell),n.value.open=!0},P=()=>{N(),n.value.id="",n.value.open=!1,D.value.deleteFileRecord()},I=J({name:S().required(t("api.CatNameRequired")),age:Q().typeError(t("api.catAgeRequired")).required(t("api.catAgeRequired")).min(0,t("api.catAgeTooSmall")),description:S().required(t("api.productDescriptionRequired")),category:S().trim().required(t("api.catBreedRequired")).oneOf(["black","orange","flower","tiger"],t("api.catBreedRequired")),sell:W().required(t("api.productSellRequired"))}),{handleSubmit:z,isSubmitting:h,resetForm:N}=X({validationSchema:I,initialValues:{name:"",age:0,description:"",category:"",sell:!1}}),b=v("name"),y=v("age"),k=v("description"),m=v("category"),w=v("sell"),j=R(()=>[{text:t("cat.selectCategory"),value:""},{text:t("catBreed.black"),value:"black"},{text:t("catBreed.orange"),value:"orange"},{text:t("catBreed.flower"),value:"flower"},{text:t("catBreed.tiger"),value:"tiger"}]),D=g(null),p=g([]),F=g([]),L=z(async e=>{var l,d,a;if(console.log("提交的值:",e),console.log("category 值:",e.category),!((l=p.value[0])!=null&&l.error)){if(n.value.id.length===0&&p.value.length===0){V({text:t("api.productImageRequired"),snackbarProps:{color:"red"}});return}try{const u=new FormData;if(u.append("name",e.name),u.append("age",e.age),u.append("description",e.description),u.append("category",e.category),u.append("sell",e.sell),p.value.length>0&&u.append("image",p.value[0].file),n.value.id.length>0)await $.patch("/product/"+n.value.id,u);else{const{data:O}=await $.post("/product",u);console.log(O)}f.splice(0,f.length),q(),V({text:t(n.value.id.length>0?"adminProduct.editSuccess":"adminProduct.newSuccess"),snackbarProps:{color:"green"}}),P()}catch(u){console.log(u),V({text:t("api."+(((a=(d=u==null?void 0:u.response)==null?void 0:d.data)==null?void 0:a.message)||"unknownError")),snackbarProps:{color:"red"}})}}});return(e,l)=>{const d=Y("VueFileAgent");return T(),Z(ye,null,[r(de,null,{default:o(()=>[r(_,null,{default:o(()=>[r(U,{cols:"12"},{default:o(()=>[ee("h1",Ae,i(e.$t("nav.adminProducts")),1)]),_:1}),r(ae),r(U,{cols:"12"},{default:o(()=>[r(te,{items:f,headers:E.value,search:C.value},{top:o(()=>[r(le,null,{default:o(()=>[r(A,{onClick:l[0]||(l[0]=a=>B(null))},{default:o(()=>[c(i(e.$t("adminProduct.new")),1)]),_:1}),r(re),r(x,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=a=>C.value=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined"},null,8,["modelValue"])]),_:1})]),"item.image":o(({value:a})=>[r(oe,{src:a,height:"50"},null,8,["src"])]),"item.sell":o(({value:a})=>[a?(T(),se(ue,{key:0,icon:"mdi-check"})):ne("",!0)]),"item.createdAt":o(({value:a})=>[c(i(new Date(a).toLocaleString()),1)]),"item.updatedAt":o(({value:a})=>[c(i(new Date(a).toLocaleString()),1)]),"item.breed":o(({value:a})=>[c(i(e.$t("catBreed."+a)),1)]),"item.edit":o(({item:a})=>[r(A,{icon:"mdi-pencil",variant:"text",onClick:u=>B(a)},null,8,["onClick"])]),_:2},1032,["items","headers","search"])]),_:1})]),_:1})]),_:1}),r(be,{modelValue:n.value.open,"onUpdate:modelValue":l[9]||(l[9]=a=>n.value.open=a),persistent:""},{default:o(()=>[r(ie,{disabled:s(h),onSubmit:ce(s(L),["prevent"])},{default:o(()=>[r(pe,null,{default:o(()=>[r(me,null,{default:o(()=>[c(i(e.$t(n.value.id?"adminProduct.edit":"adminProduct.new")),1)]),_:1}),r(ge,null,{default:o(()=>[r(x,{modelValue:s(b).value.value,"onUpdate:modelValue":l[2]||(l[2]=a=>s(b).value.value=a),label:e.$t("product.name"),"error-messages":s(b).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(x,{modelValue:s(y).value.value,"onUpdate:modelValue":l[3]||(l[3]=a=>s(y).value.value=a),label:e.$t("cat.age"),"error-messages":s(y).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","label","error-messages"]),r(ve,{modelValue:s(m).value.value,"onUpdate:modelValue":l[4]||(l[4]=a=>s(m).value.value=a),"error-messages":s(m).errorMessage.value,items:j.value,"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),r(Ve,{modelValue:s(w).value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>s(w).value.value=a),label:e.$t("product.onSell"),"error-messages":s(w).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(we,{modelValue:s(k).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>s(k).value.value=a),label:e.$t("product.description"),"error-messages":s(k).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(d,{ref_key:"fileAgent",ref:D,modelValue:p.value,"onUpdate:modelValue":l[7]||(l[7]=a=>p.value=a),"raw-model-value":F.value,"onUpdate:rawModelValue":l[8]||(l[8]=a=>F.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":e.$t("fileAgent.helpText"),"error-text":{type:e.$t("fileAgent.errorType"),size:e.$t("fileAgent.errorSize")}},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),r(fe,null,{default:o(()=>[r(A,{onClick:P},{default:o(()=>[c(i(e.$t("adminProduct.cancel")),1)]),_:1}),r(A,{type:"submit",loading:s(h)},{default:o(()=>[c(i(e.$t("adminProduct.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof M=="function"&&M($e);export{$e as default};
