import{_,u as ee,G as ae,ay as te,K as b,c as F,aq as le,ar as $,az as re,aA as se,as as ne,at as c,r as oe,o as f,h as M,d as r,w as s,V as ie,ai as de,aj as L,E as u,t as d,z as ue,aB as pe,$ as me,e as B,p as R,f as g,g as ge,ak as T,x as ce,b as N,B as ve,au as be,j as n,av as fe,an as Ve,ao as ke,ax as ye,aC as O,aD as we,ap as Ae,aE as Ce,F as xe,C as P,I as $e}from"./index-Cf2VyKK3.js";import{V as Be}from"./VTextarea-BmNjIaiT.js";const qe={class:"text-center font-weight-bold",style:{color:"#a59aa3"}},De={key:0,class:"text-brown"},Se={key:1,class:"text-grey--text"},Fe={class:"text-primary"},j={__name:"Cats",setup(Me){const{t:l}=ee(),{apiAuth:q}=$e(),V=ae(),k=te([]),D=b(""),K=F(()=>[{title:"ID",key:"_id",sortable:!0},{title:l("cat.image"),key:"image",sortable:!1},{title:l("cat.name"),key:"name",sortable:!1},{title:l("cat.age"),key:"age",sortable:!0},{title:l("cats.gender"),key:"gender",sortable:!0},{title:l("cat.breed"),key:"breed",sortable:!0},{title:l("cat.isAdopting"),key:"isAdopting",sortable:!0},{title:l("cat.description"),key:"description",sortable:!1},{title:l("cat.createdAt"),key:"createdAt",sortable:!0},{title:l("cat.updatedAt"),key:"updatedAt",sortable:!0},{title:l("adminCat.edit"),key:"edit",sortable:!1}]),U=async()=>{var t,e;try{const{data:p}=await q.get("/cat/all");k.push(...p.result)}catch(p){V({text:l("api."+(((e=(t=p==null?void 0:p.response)==null?void 0:t.data)==null?void 0:e.message)||"unknownError")),snackbarProps:{color:"rgb(212, 135, 141)"}})}};U();const i=b({open:!1,id:""}),I=t=>{t?(A.value.value=t.breed||"",i.value.id=t._id,y.value.value=t.name,w.value.value=t.age,C.value.value=t.description,v.value.value=!!t.isAdopting,x.value.value=t.gender):v.value.value=!1,i.value.open=!0},E=()=>{Q(),i.value.id="",i.value.open=!1,G.value.deleteFileRecord()},H=le({name:$().required(l("api.catNameRequired")),breed:$().required(l("api.catBreedRequired")).oneOf(["black","orange","flower","tiger"],l("api.catBreedRequired")),age:re().typeError(l("api.catAgeInvalid")).required(l("api.catAgeRequired")),description:$().required(l("api.catDescriptionRequired")),gender:$().required(l("api.catGenderRequired")).oneOf(["Male","Female"],l("api.catGenderRequired")),isAdopting:se().required(l("api.catIsadoptingRequired"))}),{handleSubmit:J,isSubmitting:z,resetForm:Q}=ne({validationSchema:H,initialValues:{name:"",age:"",description:"",breed:"",gender:"",isAdopting:!1}}),y=c("name"),w=c("age"),A=c("breed"),C=c("description"),x=c("gender"),v=c("isAdopting",void 0,{initialValue:!1}),W=F(()=>[{text:l("cat.selectBreed"),value:""},{text:l("catBreed.black"),value:"black"},{text:l("catBreed.orange"),value:"orange"},{text:l("catBreed.flower"),value:"flower"},{text:l("catBreed.tiger"),value:"tiger"}]),X=F(()=>[{text:l("cat.selectGender"),value:""},{text:l("catBreed.Male"),value:"Male"},{text:l("catBreed.Female"),value:"Female"}]),G=b(null),m=b([]),h=b([]),Y=J(async t=>{var e,p,a,S;if(!((e=m.value[0])!=null&&e.error)){if(i.value.id.length===0&&m.value.length===0){V({text:l("api.CatImageRequired"),snackbarProps:{color:"red"}});return}try{const o=new FormData;if(o.append("name",t.name),o.append("age",t.age),o.append("description",t.description),o.append("breed",t.breed),o.append("gender",t.gender),o.append("isAdopting",t.isAdopting?"true":"false"),m.value.length>0&&!((p=m.value[0])!=null&&p.error)?o.append("image",m.value[0].file):o.append("image",i.value.image||null),i.value.id.length>0)await q.patch("/cat/"+i.value.id,o);else{const{data:Z}=await q.post("/cat",o);console.log(Z)}k.splice(0,k.length),U(),V({text:l(i.value.id.length>0?"adminCat.editSuccess":"adminCat.newSuccess"),snackbarProps:{color:"rgb(117, 117, 117)"}}),E()}catch(o){console.log(o),V({text:l("api."+(((S=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:S.message)||"unknownError")),snackbarProps:{color:"rgb(212, 135, 141)"}})}}});return(t,e)=>{const p=oe("VueFileAgent");return f(),M(xe,null,[r(ve,{class:"container"},{default:s(()=>[r(ie,null,{default:s(()=>[r(de,null,{default:s(()=>[r(L,{cols:"12"},{default:s(()=>[u("h1",qe,d(t.$t("nav.adminCats")),1)]),_:1}),r(ue),r(L,{cols:"12"},{default:s(()=>[r(pe,{items:k,headers:K.value,class:"table",search:D.value},{top:s(()=>[r(me,{flat:""},{default:s(()=>[r(B,{color:"brown",rounded:"",onClick:e[0]||(e[0]=a=>I(null))},{default:s(()=>[r(R,null,{default:s(()=>e[11]||(e[11]=[g("mdi-plus")])),_:1}),g(" "+d(t.$t("adminCat.new")),1)]),_:1}),r(ge),r(T,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=a=>D.value=a),"prepend-inner-icon":"mdi-magnify",variant:"plain",class:"search-field",placeholder:"搜尋貓咪",style:{"background-color":"#e7e4e7","border-radius":"60px"},dense:""},null,8,["modelValue"])]),_:1})]),"item.image":s(({value:a})=>[r(ce,{src:a,height:"100",width:"100"},null,8,["src"])]),"item.isAdopting":s(({value:a})=>[a?(f(),N(R,{key:0,color:"brown"},{default:s(()=>e[12]||(e[12]=[g("mdi-check-circle")])),_:1})):(f(),N(R,{key:1,color:"red"},{default:s(()=>e[13]||(e[13]=[g("mdi-close-circle")])),_:1}))]),"item.age":s(({value:a})=>[a?(f(),M("span",De,d(a)+" 歲",1)):(f(),M("span",Se,"未知"))]),"item.createdAt":s(({value:a})=>[u("span",null,d(new Date(a).toLocaleDateString()),1),e[14]||(e[14]=u("br",null,null,-1)),u("span",null,d(new Date(a).toLocaleTimeString()),1),e[15]||(e[15]=u("br",null,null,-1))]),"item.updatedAt":s(({value:a})=>[u("span",null,d(new Date(a).toLocaleDateString()),1),e[16]||(e[16]=u("br",null,null,-1)),u("span",null,d(new Date(a).toLocaleTimeString()),1),e[17]||(e[17]=u("br",null,null,-1))]),"item.breed":s(({value:a})=>[u("span",Fe,d(t.$t("catBreed."+a)),1)]),"item.gender":s(({value:a})=>[u("span",null,d(t.$t("catGender."+a)),1)]),"item.edit":s(({item:a})=>[r(B,{icon:"mdi-pencil",variant:"text",color:"brown",onClick:S=>I(a)},null,8,["onClick"])]),_:2},1032,["items","headers","search"])]),_:1})]),_:1})]),_:1})]),_:1}),r(Ce,{modelValue:i.value.open,"onUpdate:modelValue":e[10]||(e[10]=a=>i.value.open=a),persistent:""},{default:s(()=>[r(be,{disabled:n(z),onSubmit:fe(n(Y),["prevent"])},{default:s(()=>[r(Ve,null,{default:s(()=>[r(ke,null,{default:s(()=>[g(d(t.$t(i.value.id?"adminCat.edit":"adminCat.new")),1)]),_:1}),r(ye,null,{default:s(()=>[r(T,{modelValue:n(y).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>n(y).value.value=a),label:t.$t("cat.name"),"error-messages":n(y).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(T,{modelValue:n(w).value.value,"onUpdate:modelValue":e[3]||(e[3]=a=>n(w).value.value=a),label:t.$t("cat.age"),"error-messages":n(w).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","label","error-messages"]),r(O,{modelValue:n(x).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>n(x).value.value=a),"error-messages":n(x).errorMessage.value,items:X.value,"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),r(O,{modelValue:n(A).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>n(A).value.value=a),"error-messages":n(A).errorMessage.value,items:W.value,"item-title":"text","item-value":"value"},null,8,["modelValue","error-messages","items"]),r(we,{modelValue:n(v).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>n(v).value.value=a),label:t.$t("cat.isAdopting"),"error-messages":n(v).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(Be,{modelValue:n(C).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>n(C).value.value=a),label:t.$t("cat.description"),"error-messages":n(C).errorMessage.value},null,8,["modelValue","label","error-messages"]),r(p,{ref_key:"fileAgent",ref:G,modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=a=>m.value=a),"raw-model-value":h.value,"onUpdate:rawModelValue":e[9]||(e[9]=a=>h.value=a),accept:"image/jpeg,image/png","help-text":t.$t("fileAgent.helpText"),"error-text":{type:t.$t("fileAgent.errorType"),size:t.$t("fileAgent.errorSize")},deletable:"","max-size":"1MB",required:""},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),r(Ae,null,{default:s(()=>[r(B,{onClick:E},{default:s(()=>[g(d(t.$t("adminCat.cancel")),1)]),_:1}),r(B,{type:"submit",loading:n(z)},{default:s(()=>[g(d(t.$t("adminCat.submit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof P=="function"&&P(j);const Ue=_(j,[["__scopeId","data-v-7cbaaf93"]]);export{Ue as default};
